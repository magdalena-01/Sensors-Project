@{
    ViewData["Title"] = "Smart Sensor OnOff";
}

<div class="container">
    <h2 class="text-center m-4">Smart Sensor Control Panel</h2>
    <p class="text-center text-muted">Manage your sensors below</p>
    
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <!-- Sensor 1 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <span>Sensor 1</span>
                    <span id="status-room-1" class="badge bg-secondary badge-indicator">Off</span>
                </div>
                <div class="card-body d-flex justify-content-between align-items-center">
                    <span class="font-weight-bold">Lights</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input switch" type="checkbox" id="room-1-switch" data-room="1">
                    </div>
                </div>
            </div>
            
            <!-- Sensor 2 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <span>Sensor 2</span>
                    <span id="status-room-2" class="badge bg-secondary badge-indicator">Off</span>
                </div>
                <div class="card-body d-flex justify-content-between align-items-center">
                    <span class="font-weight-bold">Lights</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input switch" type="checkbox" id="room-2-switch" data-room="2">
                    </div>
                </div>
            </div>
            
            <!-- Pump 1 -->
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <span>Pump 1</span>
                    <span id="status-room-3" class="badge bg-secondary badge-indicator">Off</span>
                </div>
                <div class="card-body d-flex justify-content-between align-items-center">
                    <span class="font-weight-bold">Lights</span>
                    <div class="form-check form-switch">
                        <input class="form-check-input switch" type="checkbox" id="room-3-switch" data-room="3">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".switch").on("change", function () {
                var roomNumber = $(this).data("room");
                var isChecked = $(this).is(":checked");
                var command = isChecked ? "on" : "off";
                var statusElement = $("#status-room-" + roomNumber);
                
                // Update the status badge and color immediately
                statusElement.text(isChecked ? "On" : "Off")
                    .removeClass("bg-secondary bg-danger bg-success")
                    .addClass(isChecked ? "bg-success" : "bg-danger");

                // Change the label color immediately
                $(this).parent().find('label').css('color', isChecked ? 'green' : 'red');

                // Throttle the AJAX call to prevent multiple clicks
                setTimeout(function () {
                    // Make the AJAX call
                    $.ajax({
                        url: `/home/send?command=${command}&roomNumber=${roomNumber}`,
                        method: 'GET',
                        success: function () {
                            console.log("Command successfully sent");
                        },
                        error: function () {
                            console.log("Command failed");
                        }
                    });
                }, 200); // Short debounce of 200ms to allow smooth interaction
            });
        });
    </script>
}
